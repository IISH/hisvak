<!--
Import the hisvak files.
See http://wiki.apache.org/solr/DataImportHandler
-->

<dataConfig>
    <script><![CDATA[
                function bronnen(row) {
                    var Naamorg = row.get('Naamorg');
                    var NummerOrg = row.get('NummerOrg');
                    var Bron = row.get('Bron');
                    var Bron_concat = "test"; // NummerOrg + '_' + Naamorg + '_' + Bron;
                    row.put('Bron_concat', Bron_concat);
                    return row;
                }
        ]]></script>
    <script><![CDATA[
                function leden(row) {
                var Nummer_lid = row.get('Nummer_lid');
                var Jaar = row.get('Jaar');
                var Aantalleden = row.get('Aantalleden');
                var Bronlid = row.get('Bronlid');
                var Lid_concat = "test" ; // Nummer_lid + "_" + Jaar + "_" +  Aantalleden + "_" + Bronlid ;
                row.put('Lid_concat', Lid_concat);
                return row;
                }
        ]]></script>
    <dataSource name="myfilereader" type="FileDataSource"/>
    <document>
        <entity name="jc" rootEntity="false" dataSource="null"
                processor="FileListEntityProcessor"
                fileName="^.*\.xml$" recursive="true"
                baseDir="/home/lwo/hisvak/import/normalized">
            <entity name="HISVAK" rootEntity="true"
                    dataSource="myfilereader"
                    processor="XPathEntityProcessor"
                    url="${jc.fileAbsolutePath}"
                    stream="false"
                    transformer="DateFormatTransformer,TemplateTransformer,RegexTransformer,LogTransformer"
                    logTemplate="processing ${jc.fileAbsolutePath}"
                    logLevel="info"
                    forEach="/HISVAK">
                <field column="id" xpath="/HISVAK/Nrorg_std"/>
                <field column="Nmorg_std" xpath="/HISVAK/Nmorg_std"/>
                <field column="Landelijk_s" xpath="/HISVAK/Landelijk"/>
                <field column="Afdvan_bewerkt_nr_i" xpath="/HISVAK/Afdvan_bewerkt_nr"/>
                <field column="Aangsl_bewerkt_nr_i" xpath="/HISVAK/Aangsl_bewerkt_nr"/>
                <field column="Bedrijfsgroep_s" xpath="/HISVAK/Bedrijfsgroep"/>
                <field column="Beroepsgroep_s" xpath="/HISVAK/Beroepsgroep"/>
                <field column="Plaats_StandaardNaam" xpath="/HISVAK/Plaats_StandaardNaam"/>
                <field column="Plaats_Standaardnaam_voor_index_s" xpath="/HISVAK/Plaats_Standaardnaam_voor_index"/>
                <field column="StandaardGemNaam_s" xpath="/HISVAK/StandaardGemNaam"/>
                <field column="StandaardProvincie_s" xpath="/HISVAK/StandaardProvincie"/>
                <field column="Richting_s" xpath="/HISVAK/Richting"/>
                <field column="Opr_dag_i" xpath="/HISVAK/Opr_jar"/>
                <field column="Opr_mnd_i" xpath="/HISVAK/Opr_mnd"/>
                <field column="Opr_jar_i" xpath="/HISVAK/Opr_jar"/>
                <field column="Oph_dag_i" xpath="/HISVAK/Oph_dag"/>
                <field column="Oph_mnd_i" xpath="/HISVAK/Oph_mnd"/>
                <field column="Oph_jar_i" xpath="/HISVAK/Oph_jar"/>

                <entity name="bronnen" forEach="/HISVAK/bronnen/HISVAK_BRON" transformer="script:bronnen">
                    <field column="NummerOrg_i" xpath="/NummerOrg"/>
                    <field column="Bron_concat_s" xpath="/Bron_concat"/>
                </entity>
                <entity name="leden" forEach="/HISVAK/leden/HISVAK_LID" transformer="script:leden">
                    <field column="Nummer_lid_i" xpath="/Nummer_lid"/>
                    <field column="Lid_concat_s" xpath="/Lid_concat"/>
                </entity>
            </entity>
        </entity>
    </document>
</dataConfig>